# à¸£à¸°à¸šà¸šà¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡à¸Ÿà¸¸à¸•à¸šà¸­à¸¥ (Football Field Booking System)

à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡à¸Ÿà¸¸à¸•à¸šà¸­à¸¥à¸œà¹ˆà¸²à¸™ LINE Bot à¹à¸¥à¸° Admin Dashboard à¸à¸£à¹‰à¸­à¸¡à¸£à¸°à¸šà¸šà¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™

## ğŸ¯ à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¸«à¸¥à¸±à¸

### 1. LINE Bot Integration
- à¸„à¹‰à¸™à¸«à¸²à¹€à¸§à¸¥à¸²à¸§à¹ˆà¸²à¸‡ (à¸—à¸µà¸¥à¸°à¸ªà¸™à¸²à¸¡ / à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”)
- à¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡à¸œà¹ˆà¸²à¸™ LINE
- **Stripe PromptPay QR**: à¸£à¸°à¸šà¸šà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™à¸¡à¸±à¸”à¸ˆà¸³ 200 à¸šà¸²à¸—à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹à¸™à¸šà¸ªà¸¥à¸´à¸›)
- à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ (à¸ªà¹ˆà¸§à¸™à¸¥à¸” 10%)
- à¹à¸ªà¸”à¸‡à¸£à¸²à¸„à¸²à¸•à¸²à¸¡à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² (à¸à¹ˆà¸­à¸™/à¸«à¸¥à¸±à¸‡ 18:00)

### 2. Admin Dashboard
- à¸”à¸¹à¸•à¸²à¸£à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡à¹à¸šà¸š Calendar View
- à¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡à¸œà¹ˆà¸²à¸™ UI
- à¹ƒà¸Šà¹‰à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™à¸—à¸µà¹ˆà¸¥à¸¹à¸à¸„à¹‰à¸²à¹„à¸”à¹‰à¸£à¸±à¸šà¸ˆà¸²à¸ LINE
- à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡
- à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸™à¸²à¸¡
- **Tag Management & Broadcast**: à¸£à¸°à¸šà¸šà¹à¸šà¹ˆà¸‡à¸à¸¥à¸¸à¹ˆà¸¡à¸¥à¸¹à¸à¸„à¹‰à¸² (Tags) à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸²à¸¡à¸à¸¥à¸¸à¹ˆà¸¡à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ (Broadcasting)
- **Member Management**: à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¡à¸™à¸™à¸§à¸¥ à¹à¸¥à¸°à¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸¡à¸²à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸à¸±à¸š LINE à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´

### 3. Promo Code & Campaign System
- à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹‰à¸” 6 à¸«à¸¥à¸±à¸à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
- à¸ªà¹ˆà¸§à¸™à¸¥à¸” 10% à¸«à¸£à¸·à¸­à¸ˆà¸³à¸™à¸§à¸™à¹€à¸‡à¸´à¸™à¸„à¸‡à¸—à¸µà¹ˆ
- à¸£à¸°à¸šà¸š Campaign à¸ªà¸³à¸«à¸£à¸±à¸šà¸ªà¸£à¹‰à¸²à¸‡à¸„à¸­à¸™à¹€à¸—à¸™à¸•à¹Œ Flex Message
- **Targeted Broadcasting**: à¸ªà¹ˆà¸‡ Campaign à¸«à¸²à¸¥à¸¹à¸à¸„à¹‰à¸²à¸•à¸²à¸¡ Tag à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸

### 5. Regular Booking (VIP Only) [[NEW]](ARCHITECTURE.md#12-regular-booking-vip-implementation)
- **Secret Booking Flow**: à¸à¸´à¸¡à¸à¹Œà¸£à¸«à¸±à¸ªà¸¥à¸±à¸š (à¹€à¸Šà¹ˆà¸™ "à¸ˆà¸­à¸‡à¸›à¸£à¸°à¸ˆà¸³") à¹€à¸à¸·à¹ˆà¸­à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¹‚à¸«à¸¡à¸”à¸ˆà¸­à¸‡à¸à¸´à¹€à¸¨à¸©
- **VIP Validation**: à¹€à¸‰à¸à¸²à¸° user à¸—à¸µà¹ˆà¸¡à¸µà¹à¸—à¹‡à¸ `vip` à¹ƒà¸™à¸•à¸²à¸£à¸²à¸‡ `profiles`
- **Manual Promo Codes**: à¹ƒà¸Šà¹‰à¹‚à¸„à¹‰à¸”à¸ªà¹ˆà¸§à¸™à¸¥à¸”à¸à¸´à¹€à¸¨à¸© (à¹€à¸Šà¹ˆà¸™ "TMG100") à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¸ˆà¸²à¸ Admin Dashboard
- **Usage Tracking**: à¸šà¸±à¸™à¸—à¸¶à¸à¸ˆà¸³à¸™à¸§à¸™à¸à¸²à¸£à¹ƒà¸Šà¹‰à¹‚à¸„à¹‰à¸”à¹à¸¥à¸°à¸ˆà¸³à¸à¸±à¸”à¸ªà¸´à¸—à¸˜à¸´à¹Œà¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™

### 6. Multi-App Architecture & Performance
- **Smart Routing**: à¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¹à¸¢à¸ App à¸šà¸™ Vercel à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰ Git Repo à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™
    - `linebotbooking-chi.vercel.app` -> Admin App (Default)
    - `app-booking-sand.vercel.app` -> Customer App (Booking Mode)
- **Performance Optimization**:
    - **Instant Load**: à¸«à¸™à¹‰à¸² Wallet à¹à¸¥à¸° Booking à¸–à¸¹à¸à¹‚à¸«à¸¥à¸”à¹à¸šà¸š Static Import à¹€à¸à¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸¥à¸·à¹ˆà¸™à¹„à¸«à¸¥à¸ªà¸¹à¸‡à¸ªà¸¸à¸”
    - **Parallel Data Fetching**: à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸™à¸²à¸¡, à¸•à¸²à¸£à¸²à¸‡à¸ˆà¸­à¸‡, à¹à¸¥à¸°à¸„à¸¹à¸›à¸­à¸‡ à¸à¸£à¹‰à¸­à¸¡à¸à¸±à¸™ (à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™ 40%)
    - **Branded Loader**: à¸«à¸™à¹‰à¸²à¹‚à¸«à¸¥à¸”à¹à¸šà¸š Custom UI à¸¥à¸”à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸§à¹ˆà¸²à¸£à¸­à¸™à¸²à¸™

- **Frontend**: React + TypeScript + Vite
- **Backend**: Supabase Edge Functions (Deno)
- **Database**: Supabase PostgreSQL
- **External API**: Matchday Arena API
- **Messaging**: LINE Messaging API

## ğŸ“ à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸›à¸£à¹€à¸ˆà¸„

```
à¸£à¸°à¸šà¸šà¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡/
â”œâ”€â”€ src/                          # Frontend React
â”‚   â”œâ”€â”€ App.tsx                   # Main Router & Smart Redirect Logic
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ admin/                # Admin Pages (Lazy Loaded)
â”‚   â”‚   â””â”€â”€ liff/                 # Customer Pages (Static Loaded for Speed)
â”‚   â””â”€â”€ hooks/
â”‚       â””â”€â”€ useBookingLogic.ts    # Centralized Booking Logic (Parallel Fetching)
â”‚
â”œâ”€â”€ supabase/functions/           # Edge Functions
â”‚   â”œâ”€â”€ webhook/                  # LINE Bot webhook
â”‚   â”œâ”€â”€ stripe-webhook/           # [NEW] Stripe payment confirmation
â”‚   â”œâ”€â”€ create-payment-intent/    # [NEW] Create Stripe PromptPay session
â”‚   â”œâ”€â”€ create-booking/           # à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡
â”‚   â”œâ”€â”€ use-promo-code-and-book/  # à¸ˆà¸­à¸‡à¸”à¹‰à¸§à¸¢à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™
â”‚   â”œâ”€â”€ validate-promo-code/      # à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸„à¹‰à¸”
â”‚   â”œâ”€â”€ get-bookings/             # à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸ˆà¸­à¸‡
â”‚   â”œâ”€â”€ cancel-booking/           # à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡
â”‚   â””â”€â”€ _shared/                  # Shared utilities
â”‚       â”œâ”€â”€ promoService.ts       # à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™
â”‚       â”œâ”€â”€ pricingService.ts     # à¸„à¸³à¸™à¸§à¸“à¸£à¸²à¸„à¸²
â”‚       â”œâ”€â”€ matchdayApi.ts        # Matchday API client
â”‚       â””â”€â”€ lineClient.ts         # LINE API client
â”‚
â””â”€â”€ supabase/migrations/          # Database migrations
    â””â”€â”€ 20260121_promo_codes.sql  # Promo code schema
```

## ğŸš€ à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡

### 1. Clone Repository
```bash
git clone <repository-url>
cd à¸£à¸°à¸šà¸šà¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡
```

### 2. à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡ Dependencies
```bash
npm install
```

### 3. à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Environment Variables

à¸ªà¸£à¹‰à¸²à¸‡à¹„à¸Ÿà¸¥à¹Œ `.env`:
```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
VITE_APP_MODE=booking  # Optional: 'booking', 'wallet', or leave empty for 'admin'
```

à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Supabase Secrets (à¹ƒà¸™ Dashboard):
```
LINE_CHANNEL_ACCESS_TOKEN=your_line_token
LINE_CHANNEL_SECRET=your_line_secret
MATCHDAY_TOKEN=your_matchday_token
```

### 4. Deploy Functions
```bash
npx supabase functions deploy webhook --no-verify-jwt
npx supabase functions deploy create-booking --no-verify-jwt
npx supabase functions deploy use-promo-code-and-book --no-verify-jwt
npx supabase functions deploy validate-promo-code --no-verify-jwt
npx supabase functions deploy get-bookings --no-verify-jwt
npx supabase functions deploy cancel-booking --no-verify-jwt
```

### 5. Run Development Server
```bash
npm run dev
```

## ğŸ“– à¹€à¸­à¸à¸ªà¸²à¸£à¹€à¸à¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡

- **[System Architecture](file:///c:/Users/Tmango/.gemini/antigravity/brain/4e03de1d-1d22-4cf2-a777-df27f587cbb4/system_architecture.md)** - à¸ªà¸–à¸²à¸›à¸±à¸•à¸¢à¸à¸£à¸£à¸¡à¸£à¸°à¸šà¸šà¹à¸šà¸šà¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
- **[Wallet & LIFF Guide](docs/WALLET_SYSTEM_AND_LIFF.md)** - à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸à¸²à¸£à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡à¹à¸¥à¸°à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸£à¸°à¸šà¸š Wallet/LIFF à¸‰à¸šà¸±à¸šà¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œ
- **[Implementation Plan](file:///c:/Users/Tmango/.gemini/antigravity/brain/4e03de1d-1d22-4cf2-a777-df27f587cbb4/implementation_plan.md)** - à¹à¸œà¸™à¸à¸²à¸£à¸à¸±à¸’à¸™à¸²à¸Ÿà¸µà¹€à¸ˆà¸­à¸£à¹Œà¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™
- **[Walkthrough](file:///c:/Users/Tmango/.gemini/antigravity/brain/4e03de1d-1d22-4cf2-a777-df27f587cbb4/walkthrough.md)** - à¸ªà¸£à¸¸à¸›à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¹à¸¥à¸°à¸—à¸”à¸ªà¸­à¸š

## ğŸ”§ à¸à¸²à¸£à¹à¸à¹‰à¸›à¸±à¸à¸«à¸²à¸—à¸±à¹ˆà¸§à¹„à¸›

### LINE Bot à¹„à¸¡à¹ˆà¸•à¸­à¸šà¸à¸¥à¸±à¸š
```bash
# Redeploy webhook function
npx supabase functions deploy webhook --no-verify-jwt
```

### à¸£à¸²à¸„à¸²à¹„à¸¡à¹ˆà¸•à¸£à¸‡à¸à¸±à¸™à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ Admin à¹à¸¥à¸° Matchday
- à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² `use-promo-code-and-book` à¹ƒà¸Šà¹‰ pattern à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡:
  - `fixed_price: null` à¹ƒà¸™à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡
  - à¸£à¸­ 5 à¸§à¸´à¸™à¸²à¸—à¸µà¸à¹ˆà¸­à¸™ update
  - à¸ªà¹ˆà¸‡ `price`, `change_price`, `time_start`, `time_end` à¹ƒà¸™ update

### CORS Error à¹ƒà¸™ F12
- à¹€à¸›à¹‡à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸›à¸à¸•à¸´à¹ƒà¸™ dev mode (`localhost:5173`)
- à¸ˆà¸°à¸«à¸²à¸¢à¹€à¸¡à¸·à¹ˆà¸­ deploy production

## ğŸ“ à¸ªà¸³à¸«à¸£à¸±à¸š AI/Developer

à¹€à¸¡à¸·à¹ˆà¸­à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡ function à¹ƒà¸«à¸¡à¹ˆ à¹ƒà¸«à¹‰à¸­à¹ˆà¸²à¸™:
1. [System Architecture](file:///c:/Users/Tmango/.gemini/antigravity/brain/4e03de1d-1d22-4cf2-a777-df27f587cbb4/system_architecture.md) - à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ flow à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
2. à¸”à¸¹à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸ˆà¸²à¸ `create-booking` à¸«à¸£à¸·à¸­ `use-promo-code-and-book`
3. à¹ƒà¸Šà¹‰ proven pattern à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£ update à¸£à¸²à¸„à¸²à¹ƒà¸™ Matchday

## ğŸ“ License

MIT
