import{c as V,r,j as e,s as Ce,L as me,C as Pe}from"./index-DvkZQ3g2.js";import{C as Ze,a as Fe,b as fe,c as We}from"./clock-D2jwkJpY.js";import{X as Te,C as He}from"./x-DzcxummA.js";import{T as ve}from"./tag-B4XkpkEl.js";import{U as et}from"./user-DJ4UmB_-.js";import{P as tt}from"./phone-CuEGkgau.js";import{T as Me}from"./triangle-alert-C0ICB3-P.js";import{I as st}from"./image-DeDblfbO.js";import{E as Ee,F as nt}from"./file-text-BnECjEK5.js";import{S as at}from"./save-BTiV5bVg.js";import{R as Re}from"./refresh-cw-DUCsWJIh.js";const rt=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],Be=V("banknote",rt);const it=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Ne=V("circle-check",it);const ot=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],lt=V("circle",ot);const ct=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],dt=V("message-square",ct);const mt=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],Je=V("monitor",mt);const ut=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Ye=V("qr-code",ut);const xt=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],ht=V("smartphone",xt);const pt=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],gt=V("square-pen",pt);const ft=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],yt=V("user-check",ft);const bt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],jt=V("user-x",bt);function Nt({selectedDate:a,onSelect:f,onClose:n}){const[y,S]=r.useState(new Date(a)),d=r.useRef(null);r.useEffect(()=>{function l(u){d.current&&!d.current.contains(u.target)&&n()}return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[n]);const C=(l,u)=>new Date(l,u+1,0).getDate(),E=(l,u)=>new Date(l,u,1).getDay(),b=y.getFullYear(),w=y.getMonth(),z=["à¸­à¸²","à¸ˆ","à¸­","à¸ž","à¸žà¸¤","à¸¨","à¸ª"],h=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"],Z=()=>S(new Date(b,w-1,1)),R=()=>S(new Date(b,w+1,1)),Y=l=>{const u=String(w+1).padStart(2,"0"),o=String(l).padStart(2,"0");f(`${b}-${u}-${o}`)},j=l=>{const u=new Date(a);return u.getDate()===l&&u.getMonth()===w&&u.getFullYear()===b},N=l=>{const u=new Date;return u.getDate()===l&&u.getMonth()===w&&u.getFullYear()===b},I=C(b,w),$=E(b,w),O=Array.from({length:$},(l,u)=>u),g=Array.from({length:I},(l,u)=>u+1);return e.jsxs("div",{ref:d,className:"bg-white rounded-xl shadow-xl border border-gray-100 p-4 w-[320px] select-none",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:Z,className:"p-1 hover:bg-gray-50 rounded-full text-gray-400",children:e.jsx(Ze,{size:20})}),e.jsxs("h2",{className:"text-gray-900 font-bold text-base",children:[h[w]," ",b+543]}),e.jsx("button",{onClick:R,className:"p-1 hover:bg-gray-50 rounded-full text-gray-400",children:e.jsx(Fe,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center mb-2",children:z.map(l=>e.jsx("div",{className:"text-xs font-medium text-gray-400 py-1",children:l},l))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 text-center",children:[O.map(l=>e.jsx("div",{},`blank-${l}`)),g.map(l=>{const u=j(l),o=N(l);return e.jsx("div",{className:"aspect-square flex items-center justify-center",children:e.jsx("button",{onClick:()=>Y(l),className:`
                                    w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors
                                    ${u?"bg-gray-900 text-white shadow-md":o?"text-blue-600 font-bold hover:bg-blue-50":"text-gray-700 hover:bg-gray-100"}
                                `,children:l})},l)})]})]})}function wt({isOpen:a,onClose:f,onConfirm:n,bookingDetails:y}){const[S,d]=r.useState(""),[C,E]=r.useState(""),[b,w]=r.useState(""),[z,h]=r.useState("QR PromtPay"),[Z,R]=r.useState(""),[Y,j]=r.useState([]),[N,I]=r.useState(!1),[$,O]=r.useState(!1),[g,l]=r.useState(null);r.useEffect(()=>{a&&(d(""),E(""),w(""),h("QR PromtPay"),R(""),l(null),O(!1),u())},[a]);const u=async()=>{I(!0);try{const{data:i,error:J}=await Ce.from("campaigns").select("id, name, code, discount_amount, discount_percent, reward_item").eq("status","active").gt("end_date",new Date().toISOString()).lte("start_date",new Date().toISOString());if(J)throw J;j(i||[])}catch(i){console.error("Error fetching campaigns:",i)}finally{I(!1)}};if(!a||!y)return null;const o=async i=>{if(i.preventDefault(),!S||!C){l("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ");return}O(!0),l(null);try{await n({name:S,phone:C,note:b,paymentMethod:z,campaignId:Z||void 0}),f()}catch(J){console.error(J),l(J.message||"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸ˆà¸­à¸‡")}finally{O(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:f}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsx("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:e.jsxs("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",onClick:f,children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(Te,{className:"h-6 w-6","aria-hidden":"true"})]})}),e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"}),e.jsxs("div",{className:"mt-4 bg-blue-50 p-4 rounded-md mb-6",children:[e.jsx("p",{className:"text-sm text-blue-800 font-semibold mb-1",children:y.courtName}),e.jsxs("p",{className:"text-sm text-blue-700",children:["à¸§à¸±à¸™à¸—à¸µà¹ˆ: ",y.date," ",e.jsx("br",{}),"à¹€à¸§à¸¥à¸²: ",y.startTime," - ",y.endTime]}),y.price&&e.jsxs("p",{className:"text-lg font-bold text-blue-900 mt-2",children:["à¸£à¸²à¸„à¸²: ",y.price.toLocaleString()," à¸šà¸²à¸—"]})]}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:["à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ˆà¸­à¸‡ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"text",name:"name",id:"name",required:!0,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"à¸Šà¸·à¹ˆà¸­à¸—à¸µà¸¡ / à¸¥à¸¹à¸à¸„à¹‰à¸²",value:S,onChange:i=>d(i.target.value)})})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:["à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"mt-1",children:e.jsx("input",{type:"tel",name:"phone",id:"phone",required:!0,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"08xxxxxxxx",value:C,onChange:i=>E(i.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"paymentMethod",className:"block text-sm font-medium text-gray-700",children:"à¸§à¸´à¸˜à¸µà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™"}),e.jsxs("select",{id:"paymentMethod",name:"paymentMethod",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md border",value:z,onChange:i=>h(i.target.value),children:[e.jsx("option",{value:"QR PromtPay",children:"QR PromtPay"}),e.jsx("option",{value:"à¹€à¸‡à¸´à¸™à¸ªà¸” (à¸«à¸™à¹‰à¸²à¸ªà¸™à¸²à¸¡)",children:"à¹€à¸‡à¸´à¸™à¸ªà¸” (à¸«à¸™à¹‰à¸²à¸ªà¸™à¸²à¸¡)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"campaign",className:"block text-sm font-medium text-gray-700",children:"à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™/à¸„à¸¹à¸›à¸­à¸‡"}),e.jsxs("select",{id:"campaign",name:"campaign",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md border",value:Z,onChange:i=>R(i.target.value),disabled:N,children:[e.jsx("option",{value:"",children:"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"}),Y.map(i=>e.jsxs("option",{value:i.id,children:[i.code," (",i.reward_item?`à¸Ÿà¸£à¸µ ${i.reward_item}`:i.discount_amount?`-${i.discount_amount}à¸¿`:`-${i.discount_percent}%`,")"]},i.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"note",className:"block text-sm font-medium text-gray-700",children:"à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ (Matchday Note)"}),e.jsx("div",{className:"mt-1",children:e.jsx("textarea",{id:"note",name:"note",rows:2,className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ (à¸–à¹‰à¸²à¸¡à¸µ)",value:b,onChange:i=>w(i.target.value)})})]}),g&&e.jsx("div",{className:"text-red-600 text-sm mt-2",children:g}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",disabled:$,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50",children:$?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸..."]}):"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸ˆà¸­à¸‡"}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:f,disabled:$,children:"à¸¢à¸à¹€à¸¥à¸´à¸"})]})]})]})})]})]})})}function vt({isOpen:a,onClose:f,booking:n,onBookingCancelled:y,onBookingUpdated:S}){const[d,C]=r.useState(!1),[E,b]=r.useState(null),[w,z]=r.useState(!1),[h,Z]=r.useState(""),[R,Y]=r.useState(!1),[j,N]=r.useState(!1),[I,$]=r.useState(""),[O,g]=r.useState(""),[l,u]=r.useState(""),[o,i]=r.useState(""),[J,L]=r.useState(!1);if(r.useEffect(()=>{a&&n&&(N(!1),$(n.name||""),g(n.tel||""),u(n.price?.toString()||"0"),i(n.admin_note||""),L(!!n.paid_at),b(null),z(!1),Z(""))},[a,n?.id]),!a||!n)return null;const M=m=>new Date(m.replace(" ","T")).toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit"}),ie=m=>new Date(m.replace(" ","T")).toLocaleDateString("th-TH",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),G=m=>new Date(m).toLocaleString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),ye=async()=>{C(!0),b(null);try{const m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0",F={matchId:n.id,price:parseInt(l,10),adminNote:o,isPaid:J,customerName:I,tel:O,timeStart:n.time_start,timeEnd:n.time_end};J&&n.status==="pending_payment"&&(F.status="confirmed",F.paymentStatus="paid");const U=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/update-booking",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(F)});if(!U.ok){const ee=await U.text();throw new Error(`Update failed: ${ee}`)}await U.json(),S&&S(),f()}catch(m){console.error("Update failed:",m),b(m.message||"Failed to update booking")}finally{C(!1)}},Se=async()=>{C(!0),b(null);try{const F=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/cancel-booking",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0"},body:JSON.stringify({matchId:n.id,reason:h||"Admin cancelled via Dashboard",isRefunded:R})});if(!F.ok){const U=await F.text();throw new Error(U)}y(),X()}catch(m){console.error("Cancellation failed:",m),b(m.message||"Failed to cancel booking")}finally{C(!1)}},ue=async()=>{L(!0),C(!0),b(null);try{const m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0",F={matchId:n.id,price:n.price,adminNote:(n.admin_note?n.admin_note+" | ":"")+"[Admin Confirm Payment]",isPaid:!0,status:"confirmed",paymentStatus:"paid",customerName:n.name,tel:n.tel,timeStart:n.time_start,timeEnd:n.time_end},U=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/update-booking",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(F)});if(!U.ok){const ee=await U.text();throw new Error(`Payment confirmation failed: ${ee}`)}S&&S(),f()}catch(m){b(m.message||"Failed to confirm payment")}finally{C(!1)}},X=()=>{z(!1),N(!1),Z(""),Y(!1),b(null),f()},Ie=()=>{const m=n.price;let F=0;const U=(n.admin_note||"").match(/\(-(\d+)\)/);U?F=parseInt(U[1],10):n.discount&&(F=n.discount);const ee=m+F,de=n.payment_method==="qr"&&(!!n.paid_at||n.payment_status==="paid"),oe=de?200:0,A=m-oe;return{basePrice:ee,discount:F,netPrice:m,depositAmount:oe,balance:A,isDepositPaid:de}},{basePrice:se,discount:K,netPrice:_e,depositAmount:xe,balance:T,isDepositPaid:ne}=Ie(),W=n.status==="pending_payment";return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:X}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsxs("div",{className:"absolute top-0 right-0 pt-4 pr-4 flex gap-2",children:[!j&&!w&&e.jsxs("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-indigo-600 focus:outline-none",onClick:()=>N(!0),title:"à¹à¸à¹‰à¹„à¸‚à¸‚à¹‰à¸­à¸¡à¸¹à¸¥",children:[e.jsx("span",{className:"sr-only",children:"Edit"}),e.jsx(gt,{className:"h-5 w-5","aria-hidden":"true"})]}),e.jsxs("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",onClick:X,children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx(Te,{className:"h-6 w-6","aria-hidden":"true"})]})]}),e.jsx("div",{className:"sm:flex sm:items-start w-full",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900 mb-4 flex items-center gap-2",id:"modal-title",children:[e.jsx("span",{children:"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸²à¸£à¸ˆà¸­à¸‡"}),(n.source==="line"||n.source==="line_bot_regular")&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(ht,{className:"w-3 h-3 mr-1"}),"Line"]}),n.source==="admin"&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(Je,{className:"w-3 h-3 mr-1"}),"Admin"]}),n.is_promo&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-pink-100 text-pink-800",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Promo"]}),W&&e.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 animate-pulse",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),"à¸£à¸­à¸ˆà¹ˆà¸²à¸¢à¸¡à¸±à¸”à¸ˆà¸³"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(He,{className:"w-4 h-4 mr-2 text-indigo-500"}),e.jsx("span",{className:"font-medium text-gray-900",children:ie(n.time_start)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(fe,{className:"w-4 h-4 mr-2 text-indigo-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[M(n.time_start)," - ",M(n.time_end)]})]}),n.court_name&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Je,{className:"w-4 h-4 mr-2 text-indigo-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["à¸ªà¸™à¸²à¸¡: ",n.court_name]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-3 mt-3 space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(et,{className:"w-4 h-4 mr-2 text-indigo-500 flex-shrink-0"}),j?e.jsx("input",{type:"text",value:I,onChange:m=>$(m.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-1 border",placeholder:"à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²"}):e.jsx("span",{className:"font-medium text-gray-900",children:I})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(tt,{className:"w-4 h-4 mr-2 text-indigo-500 flex-shrink-0"}),j?e.jsx("input",{type:"tel",value:O,onChange:m=>g(m.target.value),className:"shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-1 border",placeholder:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ"}):e.jsx("span",{children:O||"-"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[e.jsxs("div",{className:"flex items-center text-xs text-gray-500 bg-white p-2 rounded-md border border-gray-200",children:[n.payment_method==="qr"?e.jsx(Ye,{className:"w-4 h-4 mr-2 text-green-600"}):e.jsx(Be,{className:"w-4 h-4 mr-2 text-blue-600"}),e.jsx("span",{className:"font-medium",children:n.payment_method==="qr"?"à¸¡à¸±à¸”à¸ˆà¸³ 200 (QR)":"à¸ˆà¹ˆà¸²à¸¢à¸«à¸™à¹‰à¸²à¸ªà¸™à¸²à¸¡"})]}),e.jsxs("div",{className:`flex items-center text-xs p-2 rounded-md border border-gray-200 ${n.paid_at?"bg-green-50 text-green-700 border-green-200":W?"bg-amber-50 text-amber-700 border-amber-200":"bg-gray-50 text-gray-600"}`,children:[e.jsx(Ne,{className:`w-4 h-4 mr-2 ${n.paid_at?"text-green-500":"text-gray-300"}`}),e.jsx("span",{className:"font-bold",children:n.paid_at?"à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§":W?"à¸£à¸­à¹‚à¸­à¸™":"à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸Šà¸³à¸£à¸°"})]})]}),W&&n.timeout_at&&e.jsxs("div",{className:"flex items-center bg-amber-50 p-2 rounded-md border border-amber-100 text-[11px] text-amber-800",children:[e.jsx(Me,{className:"w-3.5 h-3.5 mr-2 text-amber-500"}),e.jsx("span",{children:"à¸ˆà¸°à¸–à¸¹à¸à¸¢à¸à¹€à¸¥à¸´à¸à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´à¸«à¸²à¸à¹„à¸¡à¹ˆà¸Šà¸³à¸£à¸°à¸ à¸²à¸¢à¹ƒà¸™: "}),e.jsx("span",{className:"font-bold ml-1",children:G(n.timeout_at)})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{className:"w-4 flex justify-center mr-2 font-bold text-indigo-500 flex-shrink-0",children:"à¸¿"}),e.jsx("span",{className:"min-w-[40px]",children:"à¸£à¸²à¸„à¸²:"}),j?e.jsx("input",{type:"number",value:l,onChange:m=>u(m.target.value),className:"ml-2 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-1 border"}):e.jsxs("span",{className:"font-medium text-gray-900 ml-2",children:[parseInt(l||"0").toLocaleString()," à¸šà¸²à¸—"]})]}),n.payment_slip_url&&e.jsxs("div",{className:"mt-3 bg-white p-3 rounded-md border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center text-xs font-semibold text-gray-700",children:[e.jsx(st,{className:"w-3 h-3 mr-1 text-indigo-500"}),"à¸ªà¸¥à¸´à¸›à¸¡à¸±à¸”à¸ˆà¸³à¸ˆà¸²à¸ LINE"]}),e.jsxs("a",{href:n.payment_slip_url,target:"_blank",rel:"noopener noreferrer",className:"text-[10px] text-indigo-600 hover:underline flex items-center",children:["à¹€à¸›à¸´à¸”à¸£à¸¹à¸›à¹€à¸•à¹‡à¸¡ ",e.jsx(Ee,{className:"w-2.5 h-2.5 ml-1"})]})]}),e.jsxs("div",{className:"relative group cursor-pointer overflow-hidden rounded-md border border-gray-100 aspect-[3/4] max-h-48 bg-gray-50 flex items-center justify-center",children:[e.jsx("img",{src:n.payment_slip_url,alt:"Payment Slip",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",onClick:()=>window.open(n.payment_slip_url,"_blank")}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center pointer-events-none",children:e.jsx(Ee,{className:"w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]})]}),W&&e.jsx("div",{className:"mt-2",children:e.jsxs("button",{type:"button",onClick:ue,disabled:d,className:"w-full inline-flex justify-center items-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-sm font-bold text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50",children:[d?e.jsx(me,{className:"animate-spin h-4 w-4 mr-2"}):e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"à¹à¸­à¸”à¸¡à¸´à¸™à¸¢à¸·à¸™à¸¢à¸±à¸™à¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§ (QR)"]})}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"w-4 flex justify-center mr-2 mt-0.5",children:J?e.jsx(Ne,{className:"w-4 h-4 text-green-500"}):e.jsx(lt,{className:"w-4 h-4 text-gray-300"})}),e.jsx("span",{className:"min-w-[40px] font-medium text-gray-900 mr-2",children:"à¸ªà¸–à¸²à¸™à¸°:"}),e.jsxs("span",{className:"relative z-0 inline-flex shadow-sm rounded-md",children:[e.jsx("button",{type:"button",onClick:()=>L(!1),className:`relative inline-flex items-center px-3 py-1 text-xs font-medium rounded-l-md border ${J?"bg-white text-gray-700 border-gray-300 hover:bg-gray-50":"bg-red-50 text-red-700 border-red-300 z-10"} focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500`,children:"à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸ˆà¹ˆà¸²à¸¢"}),e.jsx("button",{type:"button",onClick:()=>L(!0),className:`relative -ml-px inline-flex items-center px-3 py-1 text-xs font-medium rounded-r-md border ${J?"bg-green-50 text-green-700 border-green-300 z-10":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"} focus:z-10 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500`,children:"à¸ˆà¹ˆà¸²à¸¢à¹à¸¥à¹‰à¸§"})]})]}),e.jsxs("div",{className:"flex flex-col items-start text-sm text-gray-600 mt-2",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(dt,{className:"w-4 h-4 mr-2 text-indigo-500 mt-0.5"}),e.jsx("span",{className:"font-medium text-indigo-900",children:"Note (à¸ à¸²à¸¢à¹ƒà¸™):"})]}),e.jsx("textarea",{value:o,onChange:m=>i(m.target.value),rows:2,className:"mt-1 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸–à¸¶à¸‡à¸—à¸µà¸¡à¸‡à¸²à¸™..."})]}),n.remark&&e.jsxs("div",{className:"flex items-start text-sm text-gray-400 mt-2",children:[e.jsx(nt,{className:"w-4 h-4 mr-2 mt-0.5 opacity-70"}),e.jsxs("span",{className:"italic text-xs",children:["Note à¸¥à¸¹à¸à¸„à¹‰à¸²: ",n.remark]})]})]})]}),E&&e.jsx("div",{className:"mt-4 bg-red-50 border-l-4 border-red-400 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Me,{className:"h-5 w-5 text-red-400","aria-hidden":"true"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-700",children:E})})]})}),w?e.jsxs("div",{className:"mt-6 border-t border-gray-100 pt-4",children:[e.jsx("label",{htmlFor:"cancel_reason",className:"block text-sm font-medium text-gray-700 mb-2",children:"à¸ªà¸²à¹€à¸«à¸•à¸¸à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸ (à¸£à¸°à¸šà¸¸à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸à¹‡à¹„à¸”à¹‰)"}),e.jsx("input",{type:"text",id:"cancel_reason",className:"shadow-sm focus:ring-red-500 focus:border-red-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"à¹€à¸Šà¹ˆà¸™ à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸ˆà¹‰à¸‡à¸¢à¸à¹€à¸¥à¸´à¸",value:h,onChange:m=>Z(m.target.value)}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsx("input",{id:"refunded",type:"checkbox",className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded cursor-pointer",checked:R,onChange:m=>Y(m.target.checked)}),e.jsx("label",{htmlFor:"refunded",className:"ml-2 block text-sm text-gray-900 cursor-pointer",children:"à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²à¹à¸¥à¹‰à¸§ (Mark as Refunded)"})]}),e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row-reverse gap-2",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:w-auto sm:text-sm disabled:opacity-50",onClick:Se,disabled:d,children:[d?e.jsx(me,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}):null,"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¢à¸à¹€à¸¥à¸´à¸"]}),e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:w-auto sm:text-sm",onClick:()=>z(!1),disabled:d,children:"à¸à¸¥à¸±à¸š"})]})]}):e.jsxs("div",{className:"mt-6 flex flex-col gap-4",children:[!j&&(K>0||ne)&&e.jsxs("div",{className:"bg-green-50 rounded-md p-3 border border-green-100 mb-2",children:[e.jsx("h4",{className:"text-xs font-semibold text-green-800 uppercase tracking-wide mb-2",children:"à¸ªà¸£à¸¸à¸›à¸¢à¸­à¸”à¸Šà¸³à¸£à¸° (Financial Summary)"}),K>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"à¸£à¸²à¸„à¸²à¹€à¸•à¹‡à¸¡ (Base Price):"}),e.jsxs("span",{children:[se.toLocaleString()," à¸š."]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-red-600 font-medium",children:[e.jsx("span",{children:"à¸ªà¹ˆà¸§à¸™à¸¥à¸” (Discount):"}),e.jsxs("span",{children:["-",K.toLocaleString()," à¸š."]})]})]}),e.jsxs("div",{className:`flex justify-between text-sm font-bold ${ne?"text-gray-600":"text-gray-900"} ${K>0?"border-t border-green-200 mt-1 pt-1":""}`,children:[e.jsx("span",{children:"à¸¢à¸­à¸”à¸ªà¸¸à¸—à¸˜à¸´ (Total):"}),e.jsxs("span",{children:[_e.toLocaleString()," à¸š."]})]}),ne&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-green-700 font-medium mt-1",children:[e.jsx("span",{children:"à¸ˆà¹ˆà¸²à¸¢à¸¡à¸±à¸”à¸ˆà¸³à¹à¸¥à¹‰à¸§ (Paid Deposit):"}),e.jsxs("span",{children:["-",xe.toLocaleString()," à¸š."]})]}),e.jsxs("div",{className:"border-t border-green-300 mt-1 pt-1 flex justify-between text-base font-extrabold text-indigo-700",children:[e.jsx("span",{children:"à¸„à¸‡à¸„à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¸ªà¸™à¸²à¸¡ (Balance):"}),e.jsxs("span",{children:[T.toLocaleString()," à¸š."]})]})]})]}),n.is_refunded&&e.jsx("div",{className:"bg-red-50 text-red-700 px-3 py-2 rounded-md text-sm font-bold border border-red-200 text-center",children:"ðŸ’° à¹„à¸”à¹‰à¸£à¸±à¸šà¸à¸²à¸£à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¹à¸¥à¹‰à¸§ (Refunded)"}),e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",onClick:()=>z(!0),children:"à¸¢à¸à¹€à¸¥à¸´à¸à¸à¸²à¸£à¸ˆà¸­à¸‡"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",className:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:w-auto sm:text-sm",onClick:X,children:"à¸›à¸´à¸”"}),e.jsxs("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:w-auto sm:text-sm disabled:opacity-50",onClick:ye,disabled:d,children:[d?e.jsx(me,{className:"animate-spin h-4 w-4 mr-2"}):e.jsx(at,{className:"h-4 w-4 mr-2"}),"à¸šà¸±à¸™à¸—à¸¶à¸"]})]})]})]})]})})]})]})})}const St=[{id:2424,name:"à¸ªà¸™à¸²à¸¡ 1",size:"5 à¸„à¸™"},{id:2425,name:"à¸ªà¸™à¸²à¸¡ 2",size:"5 à¸„à¸™"},{id:2428,name:"à¸ªà¸™à¸²à¸¡ 3",size:"7-8 à¸„à¸™"},{id:2426,name:"à¸ªà¸™à¸²à¸¡ 4",size:"7 à¸„à¸™"},{id:2427,name:"à¸ªà¸™à¸²à¸¡ 5",size:"7 à¸„à¸™"},{id:2429,name:"à¸ªà¸™à¸²à¸¡ 6",size:"7 à¸„à¸™ (à¹ƒà¸«à¸¡à¹ˆ)"}];function It({isOpen:a,onClose:f,onSuccess:n}){const[y,S]=r.useState(""),[d,C]=r.useState(null),[E,b]=r.useState(""),[w,z]=r.useState(""),[h,Z]=r.useState(!1),[R,Y]=r.useState(!1),[j,N]=r.useState(null),[I,$]=r.useState(!1);if(!a)return null;const O=()=>{S(""),C(null),b(""),z(""),N(null),$(!1),f()},g=async()=>{if(y.length!==6||!/^\d+$/.test(y)){N("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¹‚à¸„à¹‰à¸” 6 à¸«à¸¥à¸±à¸ (à¸•à¸±à¸§à¹€à¸¥à¸‚à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™)");return}Y(!0),N(null);try{const{data:{session:i}}=await Ce.auth.getSession(),J=i?.access_token??"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0Njg4NDAsImV4cCI6MjA4NDA0NDg0MH0.04WXE3feJa8s2jBe6kmUPH00jufK8nvjSMvNmG_oFPs",L=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/validate-promo-code",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${J}`},body:JSON.stringify({code:y})});if(!L.ok){const G=await L.json();throw new Error(G.error||"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸„à¹‰à¸”à¹„à¸”à¹‰")}const M=await L.json();if(!M.valid){N(M.reason||"à¹‚à¸„à¹‰à¸”à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡");return}const ie=St.find(G=>G.id===M.code.field_id);C({...M.code,field_label:ie?.name||`à¸ªà¸™à¸²à¸¡ ${M.code.field_id}`,field_type:ie?.size||""}),M.code.profile&&(b(M.code.profile.team_name||""),z(M.code.profile.phone_number||""))}catch(i){console.error("Validation error:",i),N(i.message||"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹‚à¸„à¹‰à¸”")}finally{Y(!1)}},l=async()=>{if(d){if(!E.trim()){N("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ˆà¸­à¸‡");return}if(!w.trim()||!/^\d{9,10}$/.test(w)){N("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ 9-10 à¸«à¸¥à¸±à¸");return}Z(!0),N(null);try{const{data:{session:i}}=await Ce.auth.getSession(),J=i?.access_token??"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0Njg4NDAsImV4cCI6MjA4NDA0NDg0MH0.04WXE3feJa8s2jBe6kmUPH00jufK8nvjSMvNmG_oFPs";console.log("[PromoCodeModal] Calling use-promo-code-and-book API..."),console.log("[PromoCodeModal] Payload:",{promoCode:y,customerName:E.trim(),phoneNumber:w.trim()});const L=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/use-promo-code-and-book",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${J}`},body:JSON.stringify({promoCode:y,customerName:E.trim(),phoneNumber:w.trim()})}),M=await L.json();if(console.log("[PromoCodeModal] API Response:",M),!L.ok)throw new Error(M.error||"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡à¹„à¸”à¹‰");console.log("[PromoCodeModal] Booking successful!"),M.booking&&console.log("[PromoCodeModal] Full Booking Object:",JSON.stringify(M.booking,null,2)),$(!0),N(null),setTimeout(()=>{n(d.booking_date,d.time_from),O()},1500)}catch(i){console.error("Booking error:",i),N(i.message||"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸ˆà¸­à¸‡")}finally{Z(!1)}}},u=i=>new Date(i).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}),o=i=>{const J=new Date(i),L=J.getHours().toString().padStart(2,"0"),M=J.getMinutes().toString().padStart(2,"0");return`${L}:${M} à¸™.`};return e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:O}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-green-600"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"à¹ƒà¸Šà¹‰à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™"})]}),e.jsx("button",{onClick:O,className:"text-gray-400 hover:text-gray-500 transition-colors",children:e.jsx(Te,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[I&&e.jsxs("div",{className:"flex items-start gap-2 p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx(Pe,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-green-700",children:"à¸ˆà¸­à¸‡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!"}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"à¹‚à¸„à¹‰à¸”à¸–à¸¹à¸à¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§ à¸à¸³à¸¥à¸±à¸‡à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡..."})]})]}),j&&e.jsxs("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[e.jsx(We,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700",children:j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"à¸à¸£à¸­à¸à¹‚à¸„à¹‰à¸”à¹‚à¸›à¸£à¹‚à¸¡à¸Šà¸±à¹ˆà¸™ (6 à¸«à¸¥à¸±à¸)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",maxLength:6,value:y,onChange:i=>{S(i.target.value.replace(/\D/g,"")),C(null),N(null)},placeholder:"123456",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-center text-lg font-mono tracking-widest",disabled:R||h}),e.jsx("button",{onClick:g,disabled:y.length!==6||R||h,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),"à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š..."]}):"à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š"})]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 font-semibold mb-2",children:[e.jsx(Pe,{className:"h-5 w-5"}),e.jsx("span",{children:"à¹‚à¸„à¹‰à¸”à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡!"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"à¸ªà¸™à¸²à¸¡:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[d.field_label," (",d.field_type,")"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆ:"}),e.jsx("span",{className:"font-medium text-gray-900",children:u(d.booking_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"à¹€à¸§à¸¥à¸²:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[d.time_from," - ",d.time_to," (",d.duration_h," à¸Šà¸¡.)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"à¸£à¸²à¸„à¸²à¹€à¸•à¹‡à¸¡:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[d.original_price.toLocaleString()," à¸šà¸²à¸—"]})]}),e.jsxs("div",{className:"flex justify-between text-green-700",children:[e.jsx("span",{className:"font-medium",children:"à¸ªà¹ˆà¸§à¸™à¸¥à¸”:"}),e.jsxs("span",{className:"font-semibold",children:[d.discount_type==="percent"?`${d.discount_value}%`:`${d.discount_value} à¸šà¸²à¸—`," ","(-",d.discount_amount.toLocaleString()," à¸šà¸²à¸—)"]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-green-300",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"à¸£à¸²à¸„à¸²à¸«à¸¥à¸±à¸‡à¸«à¸±à¸:"}),e.jsxs("span",{className:"font-bold text-lg text-green-700",children:[d.final_price.toLocaleString()," à¸šà¸²à¸—"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-1",children:["â° à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸: ",o(d.expires_at)]})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸ˆà¸­à¸‡"}),e.jsx("input",{type:"text",value:E,onChange:i=>b(i.target.value),placeholder:"à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:h})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸¨à¸±à¸žà¸—à¹Œ"}),e.jsx("input",{type:"tel",maxLength:10,value:w,onChange:i=>z(i.target.value.replace(/\D/g,"")),placeholder:"0812345678",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",disabled:h})]})]})]})]}),e.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-200",children:[e.jsx("button",{onClick:O,disabled:h,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"à¸¢à¸à¹€à¸¥à¸´à¸"}),e.jsx("button",{onClick:l,disabled:!d||!E.trim()||!w.trim()||h,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 animate-spin"}),"à¸à¸³à¸¥à¸±à¸‡à¸ˆà¸­à¸‡..."]}):"à¸¢à¸·à¸™à¸¢à¸±à¸™à¹à¸¥à¸°à¸ˆà¸­à¸‡à¹€à¸¥à¸¢"})]})]})})]})}function _t({booking:a,top:f,height:n,isDragging:y,onClick:S,onMoveStart:d,onResizeStart:C}){const E=g=>{if(!g)return"";const l=new Date(g.replace(" ","T")),u=l.getHours();let o=l.getMinutes();return o===1&&(o=0),o===31&&(o=30),`${u.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`},b=g=>{g.stopPropagation(),g.button===0&&d(g)},w=(g,l)=>{g.stopPropagation(),g.button===0&&C(g,l)},z=a.status==="pending_payment",h=a.payment_method==="qr",Z=!!a.paid_at;let R="pay_at_field";Z?R="fully_paid":z?R="pending":h&&a.payment_status==="paid"&&!Z?R="deposit_paid":R="pay_at_field";let Y="",j="",N="",I="",$="";switch(R){case"pending":Y="bg-rose-50 border-rose-400 hover:bg-rose-100",j="text-rose-900",N="text-rose-800",I="text-rose-500",$="hover:bg-rose-300";break;case"deposit_paid":Y="bg-amber-50 border-amber-500 hover:bg-amber-100",j="text-amber-900",N="text-amber-800",I="text-amber-600",$="hover:bg-amber-300";break;case"fully_paid":Y="bg-emerald-50 border-emerald-500 hover:bg-emerald-100",j="text-emerald-900",N="text-emerald-800",I="text-emerald-600",$="hover:bg-emerald-300";break;default:Y="bg-blue-50 border-blue-600 hover:bg-blue-100",j="text-blue-900",N="text-blue-800",I="text-blue-500",$="hover:bg-blue-300";break}const O=a.attendance_status?a.attendance_status==="confirmed"?e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-white/80 rounded-full p-0.5 shadow-sm",title:"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¸¡à¸²à¹à¸¥à¹‰à¸§",children:e.jsx(yt,{className:"w-3.5 h-3.5 text-green-600 fill-green-100"})}):a.attendance_status==="cancel_requested"?e.jsx("div",{className:"absolute top-0.5 right-0.5 bg-red-100/90 rounded-full p-0.5 shadow-sm animate-pulse border border-red-200",title:"à¸¥à¸¹à¸à¸„à¹‰à¸²à¸‚à¸­à¸¢à¸à¹€à¸¥à¸´à¸",children:e.jsx(jt,{className:"w-3.5 h-3.5 text-red-600"})}):null:null;return e.jsxs("div",{className:`absolute inset-x-1 rounded shadow-sm border-l-[3px] px-2 py-1 text-xs transition-all z-10 group overflow-hidden select-none ${Y} ${y?"opacity-50 cursor-grabbing":"cursor-grab"}`,style:{top:`${f}px`,height:`${n}px`},title:`${E(a.time_start)} - ${E(a.time_end)} â€¢ ${a.name||"User"}`,onMouseDown:b,onClick:g=>{g.stopPropagation(),y||S(g)},children:[O,e.jsx("div",{className:`absolute top-0 left-0 right-0 h-2 cursor-n-resize z-20 hover:bg-opacity-50 transition-colors ${$}`,onMouseDown:g=>w(g,"TOP")}),e.jsxs("div",{className:"flex flex-col h-full justify-start items-start text-left pl-2 pt-1 pb-1 pr-1 pointer-events-none",children:[e.jsx("p",{className:`font-semibold text-xs leading-tight mb-0.5 truncate w-full ${j}`,children:a.name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸à¸Šà¸·à¹ˆà¸­"}),e.jsxs("div",{className:`text-[10px] font-medium opacity-90 flex items-center gap-1 ${N}`,children:[E(a.time_start)," - ",E(a.time_end),z&&e.jsx(fe,{className:"w-2.5 h-2.5 animate-pulse text-rose-600"})]}),a.tel&&n>50&&e.jsx("p",{className:"text-[10px] opacity-75 mt-0.5 truncate w-full",children:a.tel}),a.price!==void 0&&a.price!==null&&n>40&&e.jsxs("div",{className:"mt-auto pt-1 w-full flex justify-end items-center gap-1",children:[e.jsxs("div",{className:"flex items-center gap-0.5 mr-auto",children:[a.paid_at?e.jsx(Ne,{className:`w-3 h-3 ${I}`}):e.jsx(fe,{className:`w-3 h-3 ${z?"text-rose-500 animate-pulse":"text-gray-400"}`}),h?e.jsx(Ye,{className:`w-3 h-3 ${I}`}):e.jsx(Be,{className:"w-3 h-3 text-gray-400"}),a.is_promo&&e.jsx(ve,{className:"w-3 h-3 text-pink-500"}),(a.source==="line"||a.source==="line_bot_regular")&&e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:`w-3 h-3 ${Z?"text-green-600":"text-green-500"}`,children:e.jsx("path",{d:"M22 10.4c0-5.7-5-10.4-10.6-10.4C5.4.1.8 4.7.8 10.4c0 4.7 3.5 8.7 8 9.9-.4 1.6-1.3 3.3-1.4 3.5-.1.3 0 .7.3.9.1.1.3.1.4.1.2 0 .5-.1.7-.3 2.9-2.5 4.6-4.9 4.7-5.1.3 0 .5.1.8.1 5.8 0 10.7-4.1 10.7-9.1zm-13.6 2.5c-.4 0-.7-.3-.7-.7V10c0-.4.3-.7.7-.7s.7.3.7.7v2.2c0 .4-.3.7-.7.7zm3.1 0c-.4 0-.7-.3-.7-.7V10c0-.4.3-.7.7-.7s.7.3.7.7v2.2c0 .4-.3.7-.7.7zm3.1 0c-.4 0-.7-.3-.7-.7V10c0-.4.3-.7.7-.7s.7.3.7.7v2.2c0 .4-.3.7-.7.7zm3.1 0c-.4 0-.7-.3-.7-.7V10c0-.4.3-.7.7-.7s.7.3.7.7v2.2c0 .4-.3.7-.7.7z"})})]}),e.jsxs("span",{className:`inline-flex items-center rounded-sm px-1.5 py-0.5 text-[10px] font-bold border ${a.paid_at?"bg-emerald-100 text-emerald-700 border-emerald-200":R==="pending"?"bg-rose-100 text-rose-700 border-rose-200":R==="deposit_paid"?"bg-amber-100 text-amber-700 border-amber-200":"bg-blue-100 text-blue-700 border-blue-200"}`,children:["à¸¿",a.price.toLocaleString()]})]})]}),e.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-2 cursor-s-resize z-20 hover:bg-opacity-50 transition-colors ${$}`,onMouseDown:g=>w(g,"BOTTOM")})]})}const ce=[{id:2424,name:"à¸ªà¸™à¸²à¸¡ 1",size:"5 à¸„à¸™",color:"blue",price_pre:500,price_post:700},{id:2425,name:"à¸ªà¸™à¸²à¸¡ 2",size:"5 à¸„à¸™",color:"indigo",price_pre:500,price_post:700},{id:2428,name:"à¸ªà¸™à¸²à¸¡ 3",size:"7-8 à¸„à¸™",color:"purple",price_pre:1e3,price_post:1200},{id:2426,name:"à¸ªà¸™à¸²à¸¡ 4",size:"7 à¸„à¸™",color:"pink",price_pre:800,price_post:1e3},{id:2427,name:"à¸ªà¸™à¸²à¸¡ 5",size:"7 à¸„à¸™",color:"rose",price_pre:800,price_post:1e3},{id:2429,name:"à¸ªà¸™à¸²à¸¡ 6",size:"7 à¸„à¸™ (à¹ƒà¸«à¸¡à¹ˆ)",color:"orange",price_pre:1e3,price_post:1200}],re=8,we=24,je=(we-re)*60,B=1.5,te=30;function Ae(){const a=new Date,f=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),y=String(a.getDate()).padStart(2,"0");return`${f}-${n}-${y}`}function Ct(){const f=new URLSearchParams(window.location.search).get("date");return f&&/^\d{4}-\d{2}-\d{2}$/.test(f)?f:Ae()}function Mt(a){const f=new URL(window.location.href);f.searchParams.set("date",a),window.history.replaceState({},"",f.toString())}function Ft(){const[a,f]=r.useState(Ct()),[n,y]=r.useState(!1),[S,d]=r.useState([]),[C,E]=r.useState(!1),[b,w]=r.useState(null),z=r.useRef(null),[h,Z]=r.useState("NONE"),[R,Y]=r.useState(!1),[j,N]=r.useState(null),[I,$]=r.useState(null),[O,g]=r.useState(null),[l,u]=r.useState(null),[o,i]=r.useState(null),[J,L]=r.useState(0),[M,ie]=r.useState(!1),[G,ye]=r.useState(null),[Se,ue]=r.useState(!1),[X,Ie]=r.useState(null),[se,K]=r.useState(null),[_e,xe]=r.useState(!1),[T,ne]=r.useState(null),[W,m]=r.useState(!1),[F,U]=r.useState(null),ee=r.useRef(!1);r.useEffect(()=>{Mt(a),ee.current=!1},[a]),r.useEffect(()=>{le(a)},[a]),r.useEffect(()=>{if(se&&S.length>0){const t=S.find(s=>s.id===se.id);t&&JSON.stringify(t)!==JSON.stringify(se)&&K(t)}},[S,se]),r.useEffect(()=>{if(z.current&&!C&&S.length>0){if(F){const t=$e(F);z.current.scrollTo({top:t-100,behavior:"smooth"}),U(null);return}if(!ee.current){const s=new Date().getHours();if(s>=re&&s<we){const c=(s-re)*60;z.current.scrollTop=c*B-100,ee.current=!0}}}},[C,S,F]);function de(t){const s=te*B;return Math.round(t/s)*s}function oe(t){return(t-re*60)*B}function A(t){return re*60+t/B}function ae(t){const s=Math.floor(t/60),c=Math.floor(t%60);return`${s.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`}function De(t,s,c){const _=ce.find(q=>q.id===t);if(!_)return 0;const p=(c-s)/60;if(p<=0)return 0;const P=s/60,v=c/60,D=18;let x=0,k=0;v<=D?x=p:P>=D?k=p:(x=D-P,k=v-D);let Q=x*_.price_pre,H=k*_.price_post;return Q>0&&Q%100!==0&&(Q=Math.ceil(Q/100)*100),H>0&&H%100!==0&&(H=Math.ceil(H/100)*100),Math.round(Q+H)}function be(t,s,c,_){let p=De(t,s,c);if(_){const P=S.find(v=>v.id===_);if(P?.discount&&P.discount>0){const v=new Date(P.time_start.replace(" ","T")),D=new Date(P.time_end.replace(" ","T")),x=v.getHours()*60+v.getMinutes(),k=D.getHours()*60+D.getMinutes(),Q=k-x,H=Math.round(c-s),q=De(P.court_id,x,k),pe=p<q-1,ge=H<Q-1;console.log(`[Anti-Gaming] Original: ${q}, New: ${p}, Discount: ${P.discount}, isPriceDecreased: ${pe}, isDurationDecreased: ${ge}`),ge?console.log(`[Anti-Gaming] NOT applying discount (triggered). Final: ${p}`):(p=Math.max(0,p-P.discount),console.log(`[Anti-Gaming] Applying discount. Final: ${p}`))}}return p}function ke(t,s,c,_){return S.some(p=>{if(p.court_id!==t||_&&p.id===_)return!1;const P=new Date(p.time_start.replace(" ","T")),v=new Date(p.time_end.replace(" ","T")),D=P.getHours()*60+P.getMinutes(),x=v.getHours()*60+v.getMinutes();return s<x&&c>D})}async function le(t,s=!1){s||E(!0),w(null);try{const c="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0";console.log(`[Dashboard] Fetching bookings... Token available? ${!!c} Length: ${c?.length}`);const _=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/get-bookings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify({date:t})});if(!_.ok)throw new Error(await _.text());const P=((await _.json()).bookings||[]).map(v=>{let D=v.name,x=v.tel;const k=v.description||v.bill?.description;if(k&&(!x||!D||D===k)){const H=k.split(" ");if(H.length>=2){const q=H[H.length-1];/^[\d-]{5,}$/.test(q)&&(x=q,D=H.slice(0,-1).join(" "))}}const Q=v.price_total_thb!==void 0?v.price_total_thb:v.price;return{...v,name:D||k,tel:x,price:Q}});d(P)}catch(c){w(c.message)}finally{s||E(!1)}}const Qe=(t,s)=>{if(t.button!==0||t.target.closest(".booking-card"))return;const c=t.currentTarget.getBoundingClientRect(),_=t.clientY-c.top,p=Math.floor(_/(te*B))*(te*B);Z("CREATE"),Y(!0),N(p),$(p+te*B),g(s)},Le=(t,s)=>{const c=oe(new Date(s.time_start.replace(" ","T")).getHours()*60+new Date(s.time_start.replace(" ","T")).getMinutes()),_=t.target.closest(".group.cursor-crosshair");if(!_)return;const p=_.getBoundingClientRect(),v=t.clientY-p.top-c;L(v),Z("MOVE"),u(s.id),ye({x:t.clientX,y:t.clientY});const D=A(c),x=A(c+he(s.time_start,s.time_end));i({top:c,height:he(s.time_start,s.time_end),courtId:s.court_id,startMin:D,endMin:x,price:s.price,paid:!!s.paid_at,valid:!0})},Xe=(t,s)=>{Z(s==="TOP"?"RESIZE_TOP":"RESIZE_BOTTOM"),u(t.id);const c=oe(new Date(t.time_start.replace(" ","T")).getHours()*60+new Date(t.time_start.replace(" ","T")).getMinutes()),_=he(t.time_start,t.time_end);i({top:c,height:_,courtId:t.court_id,startMin:A(c),endMin:A(c+_),price:t.price,paid:!!t.paid_at,valid:!0})},Ue=t=>{if(h==="NONE")return;const s=t.currentTarget.getBoundingClientRect(),c=(s.width-60)/6,_=t.clientX-s.left-60;let p=Math.floor(_/c);p<0&&(p=0),p>5&&(p=5);const P=ce[p]?.id,v=t.clientY-s.top;if(h==="CREATE"){if(j===null||v<0||v>je*B)return;const D=te*B;let x=de(v);x<=j&&(x=j+D),$(x)}else if(h==="MOVE"&&o){if(!M&&G)if(Math.sqrt(Math.pow(t.clientX-G.x,2)+Math.pow(t.clientY-G.y,2))>5)ie(!0);else return;let D=v-J,x=de(D);x<0&&(x=0),x+o.height>je*B&&(x=je*B-o.height);const k=A(x),Q=k,H=k+o.height/B,q=!ke(P,Q,H,l),pe=be(P,Q,H,l);i({...o,top:x,courtId:P,startMin:Q,endMin:H,price:pe,valid:q})}else if((h==="RESIZE_TOP"||h==="RESIZE_BOTTOM")&&o){const D=de(v);let x=o.top,k=o.height;if(h==="RESIZE_BOTTOM")k=D-x;else{const ge=x+k;x=D,k=ge-x}k<te*B&&(h==="RESIZE_BOTTOM"||(x=o.top+o.height-te*B),k=te*B);const Q=A(x),H=A(x+k),q=!ke(o.courtId,Q,H,l),pe=be(o.courtId,Q,H,l);i({...o,top:x,height:k,startMin:Q,endMin:H,price:pe,valid:q})}},qe=()=>{if(h==="CREATE"&&O&&j!==null&&I!==null){const t=A(j),s=A(I);Ie({courtId:O,startTime:ae(t),endTime:ae(s),price:be(O,t,s)}),ue(!0)}else if(h!=="NONE"&&o&&l&&o.valid&&(M||h.startsWith("RESIZE"))){const t=S.find(s=>s.id===l);t&&(t.court_id!==o.courtId||A(o.top)!==A(oe(new Date(t.time_start.replace(" ","T")).getHours()*60+new Date(t.time_start.replace(" ","T")).getMinutes()))||o.height!==he(t.time_start,t.time_end))&&ne({original:t,new:{courtId:o.courtId,startTime:ae(o.startMin),endTime:ae(o.endMin),price:o.price}})}Ve()},Ve=()=>{Z("NONE"),Y(!1),N(null),$(null),g(null),u(null),i(null),L(0),ie(!1),ye(null)};async function Ge(){if(T){m(!0);try{const t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0",s={matchId:T.original.id,price:T.new.price,timeStart:`${a} ${T.new.startTime}:00`,timeEnd:`${a} ${T.new.endTime}:00`,courtId:T.new.courtId!==T.original.court_id?T.new.courtId:void 0,customerName:T.original.name,tel:T.original.tel,adminNote:T.original.admin_note},c=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/update-booking",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!c.ok)throw new Error(await c.text());ne(null),le(a)}catch(t){alert(`Update Failed: ${t.message}`)}finally{m(!1)}}}const Ke=async t=>{if(X)try{const c=await fetch("https://kyprnvazjyilthdzhqxh.supabase.co/functions/v1/create-booking",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt5cHJudmF6anlpbHRoZHpocXhoIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODQ2ODg0MCwiZXhwIjoyMDg0MDQ0ODQwfQ.38YYSQQeZuT8BOyb1-nKUp2wzF8RYtFBeo4j2mRcAG0"},body:JSON.stringify({fieldId:X.courtId,date:a,startTime:X.startTime,endTime:X.endTime,customerName:t.name,phoneNumber:t.phone,note:t.note,paymentMethod:t.paymentMethod,campaignId:t.campaignId,source:"admin"})});if(!c.ok)throw new Error(await c.text());le(a),ue(!1)}catch(s){alert(s.message)}},ze=t=>new Date(t).toLocaleDateString("th-TH",{weekday:"long",year:"numeric",month:"long",day:"numeric"});function $e(t){return oe(new Date(t.replace(" ","T")).getHours()*60+new Date(t.replace(" ","T")).getMinutes())}function he(t,s){return(new Date(s.replace(" ","T")).getTime()-new Date(t.replace(" ","T")).getTime())/6e4*B}const Oe=t=>{const s=new Date(t.replace(" ","T"));let c=s.getMinutes();return c===1&&(c=0),c===31&&(c=30),`${s.getHours().toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] bg-white",children:[e.jsxs("header",{className:"flex flex-none items-center justify-between border-b border-gray-200 px-6 py-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold leading-6 text-gray-900",children:ze(a)}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"à¸•à¸²à¸£à¸²à¸‡à¸à¸²à¸£à¸ˆà¸­à¸‡à¸ªà¸™à¸²à¸¡à¸Ÿà¸¸à¸•à¸šà¸­à¸¥"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"isolate inline-flex rounded-md shadow-sm",children:[e.jsx("button",{onClick:()=>{const t=new Date(a);t.setDate(t.getDate()-1),f(t.toISOString().split("T")[0])},className:"relative inline-flex items-center rounded-l-md bg-white px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:e.jsx(Ze,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>f(Ae()),className:"relative hidden md:inline-flex items-center bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 -ml-px",children:"à¸§à¸±à¸™à¸™à¸µà¹‰"}),e.jsx("button",{onClick:()=>{const t=new Date(a);t.setDate(t.getDate()+1),f(t.toISOString().split("T")[0])},className:"relative inline-flex items-center rounded-r-md bg-white px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 -ml-px",children:e.jsx(Fe,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>y(!n),className:"hidden md:flex items-center gap-x-1.5 rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[e.jsx(He,{className:"h-5 w-5 text-gray-400"}),"à¹€à¸¥à¸·à¸­à¸à¸§à¸±à¸™à¸—à¸µà¹ˆ"]}),n&&e.jsx("div",{className:"absolute right-0 top-full mt-2 z-50",children:e.jsx(Nt,{selectedDate:a,onSelect:t=>{f(t),y(!1)},onClose:()=>y(!1)})})]}),e.jsxs("button",{onClick:()=>xe(!0),className:"flex items-center gap-x-1.5 rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden md:inline",children:"à¹ƒà¸Šà¹‰à¹‚à¸„à¹‰à¸”"})]}),e.jsxs("button",{onClick:()=>le(a),className:`flex items-center gap-x-1.5 rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 ${C?"opacity-75 cursor-not-allowed":""}`,children:[e.jsx(Re,{className:`h-4 w-4 ${C?"animate-spin":""}`}),e.jsx("span",{className:"hidden md:inline",children:"à¸­à¸±à¸›à¹€à¸”à¸•"})]})]})]}),b&&e.jsxs("div",{className:"mx-6 mt-4 p-4 bg-red-50 border-l-4 border-red-500 text-red-700",children:[e.jsx("p",{className:"font-bold",children:"Error"}),e.jsx("p",{children:b})]}),e.jsx("div",{className:"flex flex-auto overflow-hidden bg-white relative",children:e.jsx("div",{ref:z,className:"flex flex-auto flex-col overflow-auto w-full",children:e.jsxs("div",{className:"flex flex-col min-w-[1000px]",children:[e.jsxs("div",{className:"sticky top-0 z-30 bg-white border-b border-gray-200 shadow-sm grid grid-cols-[60px_repeat(6,1fr)] text-sm leading-6 text-gray-500 divide-x divide-gray-200",children:[e.jsx("div",{className:"flex items-center justify-center py-3 bg-gray-50",children:e.jsx(fe,{className:"w-4 h-4 text-gray-400"})}),ce.map(t=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-3",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:t.name}),e.jsx("span",{className:"text-xs text-gray-400 font-normal",children:t.size})]},t.id))]}),e.jsxs("div",{className:"grid grid-cols-[60px_repeat(6,1fr)] w-full relative select-none",style:{height:`${je*B}px`},onMouseMove:Ue,onMouseUp:qe,children:[e.jsx("div",{className:"col-start-1 col-end-[-1] grid-rows-1 absolute inset-0 z-0 pointer-events-none",children:Array.from({length:we-re}).map((t,s)=>e.jsx("div",{className:"border-b border-gray-200 w-full relative",style:{height:`${60*B}px`},children:e.jsx("div",{className:"absolute top-1/2 left-0 right-0 border-b border-gray-200 border-dashed"})},s))}),e.jsx("div",{className:"bg-white border-r border-gray-200 z-10 text-xs text-gray-500 font-medium",children:Array.from({length:we-re}).map((t,s)=>e.jsxs("div",{className:`relative text-right pr-2 ${s===0?"":"-top-2.5"}`,style:{height:`${60*B}px`},children:[String(re+s).padStart(2,"0"),":00"]},s))}),ce.map(t=>e.jsxs("div",{className:"relative border-r border-gray-200 hover:bg-gray-50/30 transition-colors group cursor-crosshair",onMouseDown:s=>Qe(s,t.id),children:[e.jsx("div",{className:"absolute inset-y-0 left-0 w-px bg-gray-100"}),S.filter(s=>s.court_id===t.id).map(s=>l===s.id&&(M||h.startsWith("RESIZE"))?null:e.jsx(_t,{booking:s,top:$e(s.time_start),height:he(s.time_start,s.time_end),onClick:()=>K(s),onMoveStart:p=>Le(p,s),onResizeStart:(p,P)=>Xe(s,P)},s.id)),o&&o.courtId===t.id&&(M||h.startsWith("RESIZE"))&&e.jsxs("div",{className:`absolute inset-x-1 rounded shadow-sm border-l-[3px] px-2 py-1 z-20 pointer-events-none flex flex-col justify-start items-start text-xs shadow-lg transition-all ${o.valid?"bg-blue-50 border-blue-600 text-blue-700":"bg-red-100/80 border-red-500 text-red-700"}`,style:{top:`${o.top}px`,height:`${o.height}px`},children:[e.jsxs("div",{className:"font-semibold text-xs leading-tight mb-0.5 w-full flex justify-between items-center",children:[e.jsxs("span",{children:[ae(o.startMin)," - ",ae(o.endMin)]}),!o.valid&&e.jsx(Me,{className:"w-3 h-3 text-red-600"})]}),e.jsx("div",{className:"mt-auto w-full flex justify-end",children:e.jsxs("span",{className:`inline-flex items-center rounded-sm px-1.5 py-0.5 text-[10px] font-bold border ${o.paid?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-600 border-gray-200"}`,children:["à¸¿",o.price.toLocaleString()]})}),!o.valid&&e.jsx("span",{className:"font-bold mt-1 text-[10px]",children:"à¸Šà¸™à¸„à¸´à¸§à¸­à¸·à¹ˆà¸™"})]}),h==="CREATE"&&R&&O===t.id&&j!==null&&I!==null&&e.jsxs("div",{className:"absolute inset-x-1 rounded bg-green-100/80 border-2 border-green-500 border-dashed z-20 pointer-events-none flex flex-col items-center justify-center text-green-700 font-semibold text-xs shadow-lg",style:{top:`${j}px`,height:`${I-j}px`},children:[e.jsxs("span",{children:[ae(A(j))," - ",ae(A(I))]}),e.jsxs("span",{className:"mt-0.5 bg-white/60 px-1.5 rounded text-[10px] font-bold",children:["à¸¿",be(O,A(j),A(I)).toLocaleString()]})]})]},t.id))]})]})})}),e.jsx(wt,{isOpen:Se,onClose:()=>ue(!1),onConfirm:Ke,bookingDetails:X?{courtName:ce.find(t=>t.id===X.courtId)?.name||"",date:ze(a),startTime:X.startTime,endTime:X.endTime,price:X.price}:null}),e.jsx(vt,{isOpen:!!se,booking:se,onClose:()=>K(null),onBookingCancelled:()=>{K(null),le(a)},onBookingUpdated:()=>le(a,!0)}),e.jsx(It,{isOpen:_e,onClose:()=>xe(!1),onSuccess:(t,s)=>{xe(!1),t!==a?f(t):le(t),s&&U(`${t} ${s}`)}}),T&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>ne(null)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(Re,{className:"h-6 w-6 text-indigo-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸à¸²à¸£à¸ˆà¸­à¸‡"}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500 space-y-3",children:[e.jsx("p",{children:"à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸à¸²à¸£à¸ˆà¸­à¸‡à¸™à¸µà¹‰à¹ƒà¸Šà¹ˆà¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"à¹€à¸§à¸¥à¸²:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"line-through text-gray-400",children:[Oe(T.original.time_start)," - ",Oe(T.original.time_end)]}),e.jsx("span",{children:"â†’"}),e.jsxs("span",{className:"font-bold text-indigo-700",children:[T.new.startTime," - ",T.new.endTime]})]})]}),T.original.court_id!==T.new.courtId&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"à¸ªà¸™à¸²à¸¡:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"line-through text-gray-400",children:ce.find(t=>t.id===T.original.court_id)?.name}),e.jsx("span",{children:"â†’"}),e.jsx("span",{className:"font-bold text-indigo-700",children:ce.find(t=>t.id===T.new.courtId)?.name})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-base",children:[e.jsx("span",{className:"font-medium",children:"à¸£à¸²à¸„à¸²à¹ƒà¸«à¸¡à¹ˆ:"}),e.jsxs("span",{className:"font-bold text-green-700",children:["à¸¿",T.new.price.toLocaleString()]})]})]})]})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",disabled:W,onClick:Ge,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:ml-3 sm:w-auto sm:text-sm",children:W?"à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...":"à¸¢à¸·à¸™à¸¢à¸±à¸™"}),e.jsx("button",{type:"button",disabled:W,onClick:()=>ne(null),className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none sm:mt-0 sm:w-auto sm:text-sm",children:"à¸¢à¸à¹€à¸¥à¸´à¸"})]})]})]})})]})}export{Ft as default};
