import{r as o,s as x,j as e}from"./index-DvkZQ3g2.js";import{U as I}from"./user-DJ4UmB_-.js";import{P as D,S as R,a as U}from"./search-w4naiWlz.js";import{R as O}from"./refresh-cw-DUCsWJIh.js";import{P as $}from"./phone-CuEGkgau.js";import{C as q,X as p}from"./x-DzcxummA.js";import{C as z}from"./check-Bqey2j4B.js";function J(){const[g,m]=o.useState([]),[y,w]=o.useState(!1),[u,C]=o.useState(""),[l,h]=o.useState(null),[r,i]=o.useState(null),[k,f]=o.useState(!1),[n,b]=o.useState({team_name:"",phone_number:""});o.useEffect(()=>{j()},[]);const j=async()=>{w(!0);try{const{data:s,error:t}=await x.from("profiles").select("*").order("created_at",{ascending:!1});if(t)throw t;m(s||[])}catch(s){console.error("Error fetching profiles:",s),alert("Failed to load customers")}finally{w(!1)}},S=s=>{h(s.user_id),i({team_name:s.team_name,phone_number:s.phone_number})},T=()=>{h(null),i(null)},P=async()=>{if(!(!l||!r))try{const{error:s}=await x.from("profiles").update({team_name:r.team_name,phone_number:r.phone_number,updated_at:new Date().toISOString()}).eq("user_id",l);if(s)throw s;m(t=>t.map(a=>a.user_id===l?{...a,...r}:a)),h(null),i(null)}catch(s){alert("Update failed: "+s.message)}},E=()=>{b({team_name:"",phone_number:""}),f(!0)},N=()=>{f(!1)},A=async()=>{if(!n.team_name||!n.phone_number){alert("Please fill in all fields");return}try{const t={user_id:`manual_${Date.now()}`,team_name:n.team_name,phone_number:n.phone_number,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:a}=await x.from("profiles").insert([t]);if(a)throw a;m([t,...g]),f(!1)}catch(s){alert("Failed to add customer: "+s.message)}},F=async(s,t)=>{if(!t)return;const a=s.tags||[];if(a.includes(t))return;const d=[...a,t];await v(s,d)},L=async(s,t)=>{const d=(s.tags||[]).filter(c=>c!==t);await v(s,d)},v=async(s,t)=>{try{const{error:a}=await x.from("profiles").update({tags:t}).eq("user_id",s.user_id);if(a)throw a;m(d=>d.map(c=>c.user_id===s.user_id?{...c,tags:t}:c))}catch(a){alert("Error updating tags: "+a.message)}},_=g.filter(s=>(s.team_name?.toLowerCase()||"").includes(u.toLowerCase())||(s.phone_number?.toLowerCase()||"").includes(u.toLowerCase())||s.tags?.some(t=>t.toLowerCase().includes(u.toLowerCase())));return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6"})," Customer Management"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white border border-transparent rounded hover:bg-indigo-700 text-sm font-medium shadow-sm",children:[e.jsx(D,{className:"h-4 w-4"})," Add Customer"]}),e.jsxs("button",{onClick:j,className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-sm font-medium",children:[e.jsx(O,{className:`h-4 w-4 ${y?"animate-spin":""}`})," Refresh"]})]})]}),e.jsxs("div",{className:"relative mb-6 max-w-md",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(R,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search by Team Name or Phone...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:u,onChange:s=>C(s.target.value)})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden rounded-md border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:y&&g.length===0?e.jsx("li",{className:"p-4 text-center text-gray-500",children:"Loading..."}):e.jsx(e.Fragment,{children:_.length===0?e.jsx("li",{className:"p-4 text-center text-gray-500",children:"No customers found."}):_.map(s=>e.jsx("li",{className:"p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[l===s.user_id&&r?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Team Name"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-2 py-1",value:r.team_name,onChange:t=>i({...r,team_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500",children:"Phone"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-2 py-1",value:r.phone_number,onChange:t=>i({...r,phone_number:t.target.value})})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold text-xs ring-1 ring-white",children:s.team_name?.charAt(0)||"?"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",title:s.user_id,children:s.team_name||"Unknown Team"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx($,{className:"h-4 w-4 text-gray-400"}),s.phone_number||"-"]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(q,{className:"h-3 w-3"}),"Registered: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 items-center",children:[s.tags?.map(t=>e.jsxs("span",{className:`px-2 py-0.5 rounded text-xs font-medium border flex items-center gap-1 ${t==="vip"?"bg-yellow-100 text-yellow-800 border-yellow-200":t==="inactive"?"bg-red-100 text-red-800 border-red-200":"bg-gray-100 text-gray-700 border-gray-200"}`,children:[t,e.jsx("button",{onClick:()=>L(s,t),className:"hover:text-red-600 ml-1",children:e.jsx(p,{className:"w-3 h-3"})})]},t)),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("input",{type:"text",placeholder:"+ tag",className:"w-16 text-xs border border-gray-300 rounded px-1 py-0.5 focus:w-24 transition-all",onKeyDown:t=>{t.key==="Enter"&&(F(s,t.currentTarget.value),t.currentTarget.value="")}})})]})]}),e.jsx("div",{className:"ml-4 flex items-center gap-2 self-start",children:l===s.user_id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:P,className:"p-1 rounded-full bg-green-100 text-green-600 hover:bg-green-200",title:"Save",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:T,className:"p-1 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200",title:"Cancel",children:e.jsx(p,{className:"h-4 w-4"})})]}):e.jsx("button",{onClick:()=>S(s),className:"p-1 rounded-full text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 transition-colors",title:"Edit",children:e.jsx(U,{className:"h-4 w-4"})})})]})},s.user_id))})})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Add New Customer"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-500",children:e.jsx(p,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Team Name"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2",value:n.team_name,onChange:s=>b({...n,team_name:s.target.value}),placeholder:"e.g. Walk-in Team",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Phone Number"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm border px-3 py-2",value:n.phone_number,onChange:s=>b({...n,phone_number:s.target.value}),placeholder:"e.g. 0812345678"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[e.jsx("button",{onClick:N,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancel"}),e.jsx("button",{onClick:A,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Save Customer"})]})]})})]})}export{J as default};
