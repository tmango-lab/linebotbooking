import{c as f,r,s as o,j as e,C as m}from"./index-DvkZQ3g2.js";import{T as p}from"./triangle-alert-C0ICB3-P.js";import{R as g}from"./refresh-cw-DUCsWJIh.js";import{F as j,E as y}from"./file-text-BnECjEK5.js";const N=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],b=f("circle-x",N);function R(){const[l,h]=r.useState([]),[c,d]=r.useState(!1),[x,n]=r.useState(null);r.useEffect(()=>{i()},[]);const i=async()=>{d(!0);try{const{data:s,error:t}=await o.from("bookings").select("*").eq("status","cancelled").not("payment_slip_url","is",null).order("updated_at",{ascending:!1});if(t)throw t;h(s||[])}catch(s){console.error("Error fetching refunds:",s),alert("Failed to load refund list")}finally{d(!1)}},u=async s=>{const t=prompt("‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô):","‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß");if(t)try{const{error:a}=await o.from("bookings").update({admin_note:(s.admin_note||"")+` | [REFUNDED: ${t}]`}).eq("booking_id",s.booking_id);if(a)throw a;alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‚úÖ"),i()}catch(a){alert("Error updating: "+a.message)}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(p,{className:"h-6 w-6 text-red-500"})," ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Refund Queue)"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (Quote Full / Cancelled) ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤"})]}),e.jsxs("button",{onClick:i,className:"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-sm font-medium",children:[e.jsx(g,{className:`h-4 w-4 ${c?"animate-spin":""}`})," Refresh"]})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden rounded-lg border border-gray-200",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:c&&l.length===0?e.jsx("li",{className:"p-8 text-center text-gray-500",children:"Loading..."}):e.jsx(e.Fragment,{children:l.length===0?e.jsxs("li",{className:"p-12 text-center flex flex-col items-center justify-center text-gray-500",children:[e.jsx(m,{className:"h-12 w-12 text-green-100 mb-2"}),e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏Å‡∏Ñ‡πâ‡∏≤‡∏á"}),e.jsx("p",{className:"text-sm",children:"‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß"})]}):l.map(s=>{const t=s.admin_note?.includes("REFUNDED"),a=s.admin_note?.includes("QUOTA_FULL");return e.jsx("li",{className:`p-4 hover:bg-gray-50 transition-colors ${t?"bg-gray-50/50":"bg-red-50/10"}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"font-mono text-xs text-gray-400",children:["#",s.booking_id]}),a&&e.jsx("span",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-red-100 text-red-700 border border-red-200",children:"QUOTA FULL"}),t&&e.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-700 border border-green-200 flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3"})," REFUNDED"]})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.display_name}),e.jsxs("div",{className:"text-sm text-gray-600 flex items-center gap-4 mt-1",children:[e.jsxs("span",{children:["üóìÔ∏è ",new Date(s.date).toLocaleDateString("th-TH")]}),e.jsxs("span",{children:["‚è∞ ",s.time_from.substring(0,5)," - ",s.time_to.substring(0,5)]}),e.jsxs("span",{className:"font-bold text-gray-900",children:["‡∏ø",s.price_total_thb]})]}),s.admin_note&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500 bg-gray-100 p-2 rounded flex items-start gap-1",children:[e.jsx(j,{className:"w-3 h-3 mt-0.5 flex-none"}),s.admin_note]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[s.payment_slip_url&&e.jsxs("button",{onClick:()=>n(s.payment_slip_url),className:"flex items-center gap-1 text-sm text-indigo-600 hover:underline",children:[e.jsx(y,{className:"w-4 h-4"})," ‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ"]}),t?e.jsx("span",{className:"mt-2 text-xs text-gray-400 italic",children:"‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß"}):e.jsx("button",{onClick:()=>u(s),className:"mt-2 px-4 py-2 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700 shadow-sm",children:"Mark as Refunded"})]})]})},s.booking_id)})})})}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:()=>n(null),children:e.jsxs("div",{className:"relative max-w-lg w-full bg-white rounded-lg p-2",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"absolute top-2 right-2 p-1 bg-black/50 text-white rounded-full hover:bg-black/70",onClick:()=>n(null),children:e.jsx(b,{className:"w-6 h-6"})}),e.jsx("img",{src:x,alt:"Payment Slip",className:"w-full h-auto rounded"}),e.jsx("div",{className:"mt-2 text-center text-sm text-gray-500",children:"‡∏Ñ‡∏•‡∏¥‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î"})]})})]})}export{R as default};
